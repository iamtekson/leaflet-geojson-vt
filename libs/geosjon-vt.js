!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.geojsonvt=e()}}(function(){return function e(t,n,o){function r(s,u){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!u&&l)return l(s,!0);if(i)return i(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var a=n[s]={exports:{}};t[s][0].call(a.exports,function(e){var n=t[s][1][e];return r(n?n:e)},a,a.exports,e,t,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(e,t){"use strict";function n(e,t,n,i,s,u){n/=t,i/=t;for(var l=[],f=0;f<e.length;f++){var a,p,h=e[f],c=h.geometry,m=h.type;if(h.min){if(a=h.min[s],p=h.max[s],a>=n&&i>=p){l.push(h);continue}if(a>i||n>p)continue}var g=1===m?o(c,n,i,s):r(c,n,i,s,u,3===m);g.length&&l.push({geometry:g,type:m,tags:e[f].tags||null})}return l.length?l:null}function o(e,t,n,o){for(var r=[],i=0;i<e.length;i++){var s=e[i],u=s[o];u>=t&&n>=u&&r.push(s)}return r}function r(e,t,n,o,r,s){for(var u=[],l=0;l<e.length;l++){var f,a,p=0,h=0,c=null,m=e[l],g=m.area,d=m.dist,v=m.length,y=[];for(a=0;v-1>a;a++)f=c||m[a],c=m[a+1],p=h||f[o],h=c[o],t>p?h>n?(y.push(r(f,c,t),r(f,c,n)),s||(y=i(u,y,g,d))):h>=t&&y.push(r(f,c,t)):p>n?t>h?(y.push(r(f,c,n),r(f,c,t)),s||(y=i(u,y,g,d))):n>=h&&y.push(r(f,c,n)):(y.push(f),t>h?(y.push(r(f,c,t)),s||(y=i(u,y,g,d))):h>n&&(y.push(r(f,c,n)),s||(y=i(u,y,g,d))));f=m[v-1],p=f[o],p>=t&&n>=p&&y.push(f),s&&y[0]!==y[y.length-1]&&y.push(y[0]),i(u,y,g,d)}return u}function i(e,t,n,o){return t.length&&(t.area=n,t.dist=o,e.push(t)),[]}t.exports=n},{}],2:[function(e,t){"use strict";function n(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)o(n,e.features[r],t);else"Feature"===e.type?o(n,e,t):o(n,{geometry:e},t);return n}function o(e,t,n){var u,l,f,a=t.geometry,p=a.type,h=a.coordinates,c=t.properties;if("Point"===p)e.push(r(c,1,[s(h)]));else if("MultiPoint"===p)e.push(r(c,1,i(h)));else if("LineString"===p)e.push(r(c,2,[i(h,n)]));else if("MultiLineString"===p||"Polygon"===p){for(f=[],u=0;u<h.length;u++)f.push(i(h[u],n));e.push(r(c,"Polygon"===p?3:2,f))}else if("MultiPolygon"===p){for(f=[],u=0;u<h.length;u++)for(l=0;l<h[u].length;l++)f.push(i(h[u][l],n));e.push(r(c,3,f))}else if("GeometryCollection"===p)for(u=0;u<a.geometries.length;u++)o(e,{geometry:a.geometries[u],properties:c},n);else console.warn("Unsupported GeoJSON type: "+a.type)}function r(e,t,n){var o={geometry:n,type:t,tags:e||null,min:[1,1],max:[0,0]};return l(o),o}function i(e,t){for(var n=[],o=0;o<e.length;o++)n.push(s(e[o]));return t&&(a(n,t),u(n)),n}function s(e){var t=Math.sin(e[1]*Math.PI/180),n=e[0]/360+.5,o=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return[n,o,0]}function u(e){for(var t,n,o=0,r=0,i=0;i<e.length-1;i++)t=n||e[i],n=e[i+1],o+=t[0]*n[1]-n[0]*t[1],r+=Math.abs(n[0]-t[0])+Math.abs(n[1]-t[1]);e.area=Math.abs(o/2),e.dist=r}function l(e){var t=e.geometry,n=e.min,o=e.max;if(1===e.type)f(n,o,t);else for(var r=0;r<t.length;r++)f(n,o,t[r]);return e}function f(e,t,n){for(var o,r=0;r<n.length;r++)o=n[r],e[0]=Math.min(o[0],e[0]),t[0]=Math.max(o[0],t[0]),e[1]=Math.min(o[1],e[1]),t[1]=Math.max(o[1],t[1])}t.exports=n;var a=e("./simplify")},{"./simplify":4}],3:[function(e,t){"use strict";function n(e,t){return new o(e,t)}function o(e,t){t=this.options=l(Object.create(this.options),t);var n=t.debug;n&&console.time("preprocess data");var o=1<<t.baseZoom,r=f(e,t.tolerance/(o*t.extent));this.tiles={},n&&(console.timeEnd("preprocess data"),console.time("generate tiles up to z"+t.maxZoom),this.stats=[],this.total=0),this.splitTile(r,0,0,0),n&&(console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles up to z"+t.maxZoom),console.log("tiles generated:",this.total,this.stats))}function r(e,t,n){if(1!==e.length)return!1;var o=e[0];if(3!==o.type||o.geometry.length>1)return!1;for(var r=0;r<o.geometry[0].length;r++){var i=o.geometry[0][r];if(i[0]!==-n&&i[0]!==t+n||i[1]!==-n&&i[1]!==t+n)return!1}return!0}function i(e,t,n){return 32*((1<<e)*n+t)+e}function s(e,t,n){return[n,(n-e[0])*(t[1]-e[1])/(t[0]-e[0])+e[1],1]}function u(e,t,n){return[(n-e[1])*(t[0]-e[0])/(t[1]-e[1])+e[0],n,1]}function l(e,t){for(var n in t)e[n]=t[n];return e}t.exports=n;var f=e("./convert"),a=e("./clip"),p=e("./tile");o.prototype.options={baseZoom:14,maxZoom:4,maxPoints:100,tolerance:3,extent:4096,buffer:64,debug:0},o.prototype.splitTile=function(e,t,n,o,l,f,h){for(var c=[e,t,n,o],m=this.options,g=m.debug,d=m.extent,v=m.buffer;c.length;){e=c.shift(),t=c.shift(),n=c.shift(),o=c.shift();var y=1<<t,x=i(t,n,o),b=this.tiles[x],M=t===m.baseZoom?0:m.tolerance/(y*d);if(b||(g>1&&console.time("creation"),b=this.tiles[x]=p(e,y,n,o,M,d,t===m.baseZoom),g&&(g>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,o,b.numFeatures,b.numPoints,b.numSimplified),console.timeEnd("creation")),this.stats[t]=(this.stats[t]||0)+1,this.total++)),!l&&(t===m.maxZoom||b.numPoints<=m.maxPoints||r(b.features,d,v))||t===m.baseZoom||t===l)b.source=e;else{b.source=l?e:null,g>1&&console.time("clipping");var P,w,Z,E,F,S,z,O,T,q=.5*v/d,j=.5-q,C=.5+q,L=1+q;l&&(z=1<<l-t,O=.5>f/z-n,T=.5>h/z-o),P=w=Z=E=F=S=null,(!l||O)&&(F=a(e,y,n-q,n+C,0,s)),l&&O||(S=a(e,y,n+j,n+L,0,s)),F&&((!l||T)&&(P=a(F,y,o-q,o+C,1,u)),l&&T||(w=a(F,y,o+j,o+L,1,u))),S&&((!l||T)&&(Z=a(S,y,o-q,o+C,1,u)),l&&T||(E=a(S,y,o+j,o+L,1,u))),g>1&&console.timeEnd("clipping"),P&&c.push(P,t+1,2*n,2*o),w&&c.push(w,t+1,2*n,2*o+1),Z&&c.push(Z,t+1,2*n+1,2*o),E&&c.push(E,t+1,2*n+1,2*o+1)}}},o.prototype.getTile=function(e,t,n){var o=i(e,t,n);if(this.tiles[o])return this.tiles[o];var s=this.options,u=s.debug;u>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var l,f=e,a=t,p=n;!l&&f>0;)f--,a=Math.floor(a/2),p=Math.floor(p/2),l=this.tiles[i(f,a,p)];if(u>1&&console.log("found parent tile z%d-%d-%d",f,a,p),l.source){if(r(l.features,s.extent,s.buffer))return l;u&&console.time("drilling down"),this.splitTile(l.source,f,a,p,e,t,n),u&&console.timeEnd("drilling down")}return this.tiles[o]}},{"./clip":1,"./convert":2,"./tile":5}],4:[function(e,t){"use strict";function n(e,t){var n,r,i,s,u=t*t,l=e.length,f=0,a=l-1,p=[];for(e[f][2]=1,e[a][2]=1;a;){for(r=0,n=f+1;a>n;n++)i=o(e[n],e[f],e[a]),i>r&&(s=n,r=i);r>u&&(e[s][2]=r,p.push(f,s,s,a)),a=p.pop(),f=p.pop()}}function o(e,t,n){var o=t[0],r=t[1],i=n[0],s=n[1],u=e[0],l=e[1],f=i-o,a=s-r;if(0!==f||0!==a){var p=((u-o)*f+(l-r)*a)/(f*f+a*a);p>1?(o=i,r=s):p>0&&(o+=f*p,r+=a*p)}return f=u-o,a=l-r,f*f+a*a}t.exports=n},{}],5:[function(e,t){"use strict";function n(e,t,n,r,i,s,u){for(var l={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null},f=0;f<e.length;f++)l.numFeatures++,o(l,e[f],t,n,r,i,s,u);return l}function o(e,t,n,o,i,s,u,l){var f,a,p,h,c=t.geometry,m=t.type,g=[],d=s*s;if(1===m)for(f=0;f<c.length;f++)g.push(r(c[f],n,o,i,u)),e.numPoints++,e.numSimplified++;else for(f=0;f<c.length;f++)if(p=c[f],l||!(2===m&&p.dist<s||3===m&&p.area<d)){var v=[];for(a=0;a<p.length;a++)h=p[a],(l||h[2]>d)&&(v.push(r(h,n,o,i,u)),e.numSimplified++),e.numPoints++;g.push(v)}else e.numPoints+=p.length;g.length&&e.features.push({geometry:g,type:m,tags:t.tags||null})}function r(e,t,n,o,r){var i=Math.round(r*(e[0]*t-n)),s=Math.round(r*(e[1]*t-o));return[i,s]}t.exports=n},{}]},{},[3])(3)});
